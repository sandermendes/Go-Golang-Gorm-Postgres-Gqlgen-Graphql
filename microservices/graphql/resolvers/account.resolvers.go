package resolvers

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.31

import (
	"context"

	"github.com/sandermendes/Go-Golang-Gorm-Postgres-Gqlgen-Graphql/main/microservices/graphql/model"
	accountv1 "github.com/sandermendes/Go-Golang-Gorm-Postgres-Gqlgen-Graphql/main/shared/protobufs/_generated/account/v1"
	"github.com/sandermendes/Go-Golang-Gorm-Postgres-Gqlgen-Graphql/main/shared/utils"
	"google.golang.org/protobuf/types/known/emptypb"
)

type AccountResolver struct {
	*Resolver
}

// type mutationResolver struct{ *Resolver }

// CreateUser is the resolver for the createUser field.
func (r *Resolver) Register(ctx context.Context, input model.Register) (*model.AccountResponse, error) {
	// Covert to protobuf to
	var registerInput accountv1.RegisterRequest
	if err := utils.Copy(&registerInput, &input); err != nil {
		return nil, err
	}

	// Connect to Account Service and try to get some feedback from hin
	register, err := r.accountConn.Register(ctx, &registerInput)
	if err != nil {
		return nil, utils.FmtLogError(err)
	}

	// Convert result
	var accountResponse model.AccountResponse
	if err := utils.Copy(&accountResponse, &register); err != nil {
		return nil, err
	}
	return &accountResponse, nil
}

// Login is the resolver for check user credentials.
func (r *Resolver) Login(ctx context.Context, input model.Login) (*model.AccountResponse, error) {
	// Covert to protobuf to
	var loginInput accountv1.LoginRequest
	if err := utils.Copy(&loginInput, &input); err != nil {
		return nil, err
	}

	// Connect to Account Service and try to get some feedback from hin
	login, err := r.accountConn.Login(ctx, &loginInput)
	if err != nil {
		return nil, utils.FmtLogError(err)
	}

	// Convert result
	var loginResponse model.AccountResponse
	if err := utils.Copy(&loginResponse, &login); err != nil {
		return nil, err
	}
	return &loginResponse, nil
}

// Me return info about current user(logged user)
func (r *Resolver) Me(ctx context.Context) (*model.User, error) {
	// TODO: Implement some logs

	me, err := r.accountConn.Me(ctx, &emptypb.Empty{})
	if err != nil {
		// TODO: Improver error return
		return nil, err
	}

	var meResponse model.User
	if err := utils.Copy(&meResponse, &me); err != nil {
		// TODO: Improver error return
		return nil, err
	}
	return &meResponse, nil
}
